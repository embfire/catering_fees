<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guest count fee</title>
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.1.1/src/regular/style.css">
    <link rel="stylesheet" href="styles.css">
    <script src="fees-store.js" defer></script>
    <script src="guest-count-advanced-script.js" defer></script>
</head>
<body class="guest-count-advanced">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="close-button" aria-label="Close">
                    <i class="ph ph-x icon-24" aria-hidden="true"></i>
                </button>
                <h1 class="header-title">Guest count fee</h1>
            </div>
            <div class="header-right">
                <button class="btn-activate" id="guest-count-toggle">Activate</button>
            </div>
        </header>
        <div class="unsaved-bar" id="guest-count-unsaved">
            <span class="unsaved-title">Unsaved changes</span>
            <div class="unsaved-actions">
                <button class="btn-secondary" id="guest-count-cancel" type="button">Cancel</button>
                <button class="btn-activate" id="guest-count-save" type="button">Save</button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <section class="page-header">
                <h1 class="page-title">Guest count fee</h1>
                <p class="page-description">Automatically adjust fees based on the number of guests</p>
                <div class="divider"></div>
            </section>

            <section class="table-section" data-variant="A">
                <div class="table-header">
                    <h2 class="table-title">Guest count ranges</h2>
                    <button class="btn-secondary btn-with-icon" id="add-range">
                        <i class="ph ph-plus icon-16" aria-hidden="true"></i>
                        Add range
                    </button>
                </div>
                <div class="table-container">
                    <table class="fee-table fee-table-editable">
                        <thead>
                            <tr>
                                <th>FROM</th>
                                <th>TO</th>
                                <th>CALCULATION</th>
                                <th>FEE</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="guest-range-body"></tbody>
                    </table>
                    <p class="table-empty" id="guest-count-empty" hidden>No guest count ranges added yet.</p>
                </div>
            </section>

            <section class="rules-section" data-variant="B">
                <div class="rules-card">
                    <h2 class="rules-title">Guest count thresholds</h2>
                    <div class="rules-list" id="guest-count-rules-list"></div>
                    <form class="rules-add-row" id="guest-count-rule-form">
                        <span class="rules-text">If the number of guest is equal to or higher than</span>
                        <div class="rules-field">
                            <div class="input-field input-field-compact">
                                <input type="number" class="text-input rules-input rules-input-min" id="guest-count-min-input" min="0" step="1" inputmode="numeric" placeholder="">
                            </div>
                            <p class="rules-error" id="guest-count-min-error"></p>
                        </div>
                        <span class="rules-text">the fee is</span>
                        <div class="rules-field">
                            <div class="input-field input-field-compact">
                                <span class="input-prefix" id="guest-count-fee-prefix">$</span>
                                <input type="number" class="text-input rules-input rules-input-fee" id="guest-count-fee-input" min="0" step="0.01" inputmode="decimal" placeholder="">
                                <span class="input-suffix is-hidden" id="guest-count-fee-suffix">%</span>
                            </div>
                            <p class="rules-error" id="guest-count-fee-error"></p>
                        </div>
                        <div class="rules-field">
                            <div class="input-wrapper">
                                <div class="input-field select-field" id="guest-count-calc-select" role="button" tabindex="0" aria-haspopup="listbox" aria-expanded="false">
                                    <span class="select-text" id="guest-count-calc-display">Percent</span>
                                    <div class="select-actions">
                                        <span class="select-caret" aria-hidden="true">
                                            <i class="ph ph-caret-down icon-16"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="select-menu" id="guest-count-calc-menu" role="listbox" aria-hidden="true">
                                    <button class="select-option" type="button" role="option" data-value="flat">
                                        <span class="select-check"></span>
                                        <span class="select-option-text">Flat</span>
                                    </button>
                                    <button class="select-option" type="button" role="option" data-value="perPerson">
                                        <span class="select-check"></span>
                                        <span class="select-option-text">Per person</span>
                                    </button>
                                    <button class="select-option is-selected" type="button" role="option" data-value="percent">
                                        <span class="select-check"><i class="ph ph-check icon-16" aria-hidden="true"></i></span>
                                        <span class="select-option-text">Percent</span>
                                    </button>
                                </div>
                                <input type="hidden" id="guest-count-calc-type" value="percent">
                            </div>
                        </div>
                        <button class="btn-activate rules-add-button" type="submit">Add</button>
                    </form>
                    <p class="rules-error rules-error-global" id="guest-count-rule-global-error"></p>
                </div>
            </section>
        </main>
    </div>

    <!-- Activation Warning Dialog -->
    <div class="modal-backdrop" id="guest-activation-dialog" aria-hidden="true">
        <div class="dialog">
            <div class="dialog-content">
                <p class="dialog-title">Add guest ranges first</p>
                <p class="dialog-body" id="guest-activation-body">Add at least one guest range before activating this fee.</p>
            </div>
            <div class="dialog-actions">
                <button class="btn-activate" type="button" id="guest-activation-ok">Got it</button>
            </div>
        </div>
    </div>

    <!-- Open-ended Range Dialog -->
    <div class="modal-backdrop" id="guest-open-ended-dialog" aria-hidden="true">
        <div class="dialog">
            <div class="dialog-content">
                <p class="dialog-title">Open-ended range required</p>
                <p class="dialog-body">Add an open-ended range to cover all guest counts.</p>
            </div>
            <div class="dialog-actions">
                <button class="btn-activate" type="button" id="guest-open-ended-ok">Got it</button>
            </div>
        </div>
    </div>

    <!-- Deactivation Confirmation Dialog -->
    <div class="modal-backdrop" id="guest-deactivate-dialog" aria-hidden="true">
        <div class="dialog">
            <div class="dialog-content">
                <p class="dialog-title">Deactivate guest count fee?</p>
                <p class="dialog-body">This will stop applying guest count fees to new orders. Your ranges will be saved.</p>
            </div>
            <div class="dialog-actions">
                <button class="btn-secondary" type="button" id="guest-deactivate-cancel">Cancel</button>
                <button class="btn-destructive" type="button" id="guest-deactivate-confirm">Deactivate</button>
            </div>
        </div>
    </div>

    <div class="snackbar" id="fee-snackbar" role="status" aria-live="polite">
        <span class="snackbar-icon" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 22 22" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <ellipse cx="11" cy="11" rx="8.00003" ry="8" fill="#44AB0B"/>
                <path d="M13.6721 7.58953C13.8988 7.24284 14.3636 7.14556 14.7103 7.37224C15.0254 7.57831 15.1345 7.98118 14.9814 8.31319L14.9276 8.4104L10.6776 14.9104C10.4289 15.2907 9.91 15.3585 9.57265 15.0788L9.49235 15.0017L7.24234 12.5017C6.96525 12.1938 6.9902 11.7196 7.29809 11.4425C7.57798 11.1906 7.99534 11.1883 8.2771 11.4213L8.35729 11.4982L9.95482 13.274L13.6721 7.58953Z" fill="white"/>
            </svg>
        </span>
        <span class="snackbar-message">Snackbar message</span>
    </div>
</body>
</html>
